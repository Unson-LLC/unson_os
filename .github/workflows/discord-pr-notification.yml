name: Discord PR Notification

on:
  pull_request:
    types: [opened, closed]
  pull_request_review:
    types: [submitted]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Generate PR Summary
      id: summary
      run: |
        # PRæƒ…å ±ã‚’å–å¾—
        PR_TITLE="${{ github.event.pull_request.title }}"
        PR_MERGED="${{ github.event.pull_request.merged }}"
        
        # ç°¡æ½”ãªè¦ç´„ã‚’ç”Ÿæˆ
        if [ "$PR_MERGED" = "true" ]; then
            SUMMARY="âœ… PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸï¼"
        else
            SUMMARY="ğŸ”„ æ–°ã—ã„PRãŒä½œæˆã•ã‚Œã¾ã—ãŸ"
        fi
        
        echo "SUMMARY=$SUMMARY" >> $GITHUB_OUTPUT
        
    - name: Send PR Opened Notification
      if: github.event.action == 'opened'
      uses: tsickert/discord-webhook@v5.3.0
      with:
        webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
        username: UnsonOS Bot
        avatar-url: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
        embed-title: "ğŸ”„ æ–°ã—ã„PRãŒä½œæˆã•ã‚Œã¾ã—ãŸ"
        embed-url: "${{ github.event.pull_request.html_url }}"
        embed-description: |
          **${{ github.event.pull_request.title }}**
          
          **ä½œæˆè€…:** ${{ github.event.pull_request.user.login }}
          **ãƒ–ãƒ©ãƒ³ãƒ:** `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`
          
          [PRã‚’ç¢ºèªã™ã‚‹](${{ github.event.pull_request.html_url }})
        embed-color: 3447003
        
    - name: Send PR Merged Notification
      if: github.event.pull_request.merged == true
      uses: tsickert/discord-webhook@v5.3.0
      with:
        webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
        username: UnsonOS Bot
        avatar-url: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
        embed-title: "âœ… PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸï¼"
        embed-url: "${{ github.event.pull_request.html_url }}"
        embed-description: |
          **${{ github.event.pull_request.title }}**
          
          **ãƒãƒ¼ã‚¸è€…:** ${{ github.event.pull_request.merged_by.login }}
          **ä½œæˆè€…:** ${{ github.event.pull_request.user.login }}
          
          [ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’è¦‹ã‚‹](${{ github.event.pull_request.html_url }}/commits)
        embed-color: 2067276