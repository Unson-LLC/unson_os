# 📊 ナレッジベースのコスト分析

## 🏗️ システム構成とコスト

### 1. Neon Database（現在使用中）

#### 無料枠（Free Tier）
- **ストレージ**: 0.5GB まで無料
- **コンピュート**: 月191.9時間（0.25 vCPU × 24時間稼働可能）
- **現在のステータス**: ✅ **無料枠内で運用中**

#### 現在の使用量（推定）
```
knowledge_experiments: ~100KB（1レコード）
campaign_metrics: ~50KB（1レコード）
合計: ~150KB（0.00015GB）

→ 無料枠0.5GBの0.03%使用
→ 約3,333レコードまで無料で保存可能
```

#### 将来のコスト予測
```
100サービス × 週1実験 × 52週 = 年5,200レコード

必要ストレージ: ~0.78GB
→ Launchプラン（$19/月）が必要
→ 年間コスト: $228（約34,200円）
```

---

### 2. OpenAI API（ベクトル埋め込み）

#### 現在のステータス
⚠️ **未実装**（pgvectorテーブルは作成済み、埋め込みは未生成）

#### コスト構造
```
text-embedding-3-small:
- $0.020 per 1M tokens
- 1レコード: ~500 tokens
- 100レコード: ~$0.001（約0.15円）
```

#### 将来のコスト予測
```
年5,200レコード × 500 tokens = 260万tokens
→ 年間コスト: $52（約7,800円）

検索時のクエリ埋め込み:
- 1日10クエリ × 365日 = 3,650クエリ
- 年間コスト: ~$0.04（約6円）
```

---

## 💰 総コスト分析

### Phase 1（現在）: 無料
- Neon Free Tier: **¥0**
- OpenAI: **¥0**（未実装）

### Phase 2（10-50サービス）: 無料
- Neon Free Tier: **¥0**
- OpenAI: **~¥500/年**

### Phase 3（100サービス）: 有料化
- Neon Launch: **¥34,200/年**
- OpenAI: **~¥8,000/年**
- **合計: ¥42,200/年**（¥3,517/月）

---

## 🎯 コスト負担モデル

### 現在の負担
- **UnsonOS中核システム**が負担
- 個別サービスへの課金なし

### 将来の負担モデル案

#### Option A: 中央集権型
```
UnsonOS運営費として一括負担
- メリット: シンプル、全サービスが恩恵
- デメリット: 固定費増加
```

#### Option B: 利用量課金型
```
各サービスが使用量に応じて負担
- 1クエリ: ¥0.1
- 1レコード保存: ¥10
- メリット: 公平性
- デメリット: 管理複雑
```

#### Option C: DAOトークン型
```
$UNSONトークンでアクセス権購入
- メリット: エコシステム強化
- デメリット: 実装コスト
```

---

## 📈 ROI試算

### コスト
- 年間: ¥42,200（100サービス時）

### ベネフィット
- **時間削減**: 30% → 開発工数削減 ¥500,000/年
- **CPA改善**: 20% → 広告費削減 ¥300,000/年
- **失敗回避**: 同じミス防止 → ¥200,000/年

### **ROI: 2,269%**（投資の23倍のリターン）

---

## 🚀 推奨アクション

### 短期（3ヶ月）
1. **無料枠で運用継続**
2. 10サービス分のデータ蓄積
3. ROI実測値の収集

### 中期（6ヶ月）
1. OpenAI埋め込み実装（¥500/年）
2. 効果測定レポート作成
3. 課金モデルの決定

### 長期（1年）
1. Neon Launchプラン移行
2. 自動化ツール開発
3. DAOメンバーへの開放

---

## ⚡ コスト最適化Tips

1. **バッチ処理**
   - 埋め込み生成を夜間バッチで実行
   - APIコール数削減

2. **キャッシュ活用**
   - 頻出クエリの結果をキャッシュ
   - 埋め込み再生成を最小化

3. **データ圧縮**
   - 古いデータをアーカイブ
   - JSONBフィールドの最適化

4. **段階的スケール**
   - 必要に応じてプラン変更
   - 使用量モニタリング

---

## 📊 まとめ

- **現在**: 完全無料で運用可能
- **損益分岐点**: 5サービス（ROI 100%超）
- **100サービス時**: 月¥3,517（ROI 2,269%）

**結論**: 極めて費用対効果の高いシステム。まずは無料枠で価値実証し、段階的にスケールすることを推奨。